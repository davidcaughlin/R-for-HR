# Filtering Data: Chapter Supplement {.unnumbered #filter_supplement}

In addition to the `filter` function from the `dplyr` package covered in [Filtering Data](#filter), we can use the `subset` function from base R to subset cases from a data frame and to select cases from a data frame. Because this function comes from base R, we do not need to install and access an additional package like we do with the `filter` function, which some may prefer or find advantageous. 

#### Functions & Packages Introduced {.unnumbered}

Function           | Package
------------------ | ------------------
`subset`           | base `R`

#### Initial Steps {.unnumbered #initsteps_filter_supp}

If required, please refer to the [Initial Steps](#initsteps_filter) section from the chapter for more information on these initial steps.

```{r, eval=FALSE}
# Set your working directory
setwd("H:/RWorkshop")
```
```{r, eval=FALSE}
# Install readr package if you haven't already
# [Note: You don't need to install a package every 
# time you wish to access it]
install.packages("readr")
```
```{r}
# Access readr package
library(readr)

# Read data and name data frame (tibble) objects
personaldata <- read_csv("PersData.csv")
performancedata <- read_csv("PerfData.csv")

# View the names of the variables in the data frame (tibble) objects
names(personaldata)
names(performancedata)
```
```{r}
# View data frame (tibble) objects
personaldata
performancedata
```
```{r, eval=FALSE}
# Install readr package if you haven't already
# [Note: You don't need to install a package every 
# time you wish to access it]
install.packages("dplyr")
```
```{r, message=FALSE, warning=FALSE}
# Access package
library(dplyr)
```
```{r}
# Full join (without pipe)
mergeddf <- full_join(personaldata, performancedata, by="id")

# View joined (merged) data frame object
mergeddf
```

## `subset` Function from Base R {.unnumbered #filter_supp}

As an alternative to the `filter` function from the `dplyr` package, we will learn how to use the `subset` function from base R to filter cases from a data frame and to select or remove variables from a data frame. 

### Filter Cases from Data Frame

We'll begin by filtering cases from a data frame object. In R, we can apply any one of the following logical operators when filtering cases from a data frame or table object.

Logical Operator   | Definition
------------------ | ---------------------------
`<`                | "less than"
`>`                | "greater than"
`<=`               | "less than or equal to"
`>=`               | "greater than or equal to"
`==`               | "equal to"
`!=`               | "not equal to"
`|`                | "or"
`&`                | "and"
`!`                | "not"

To filter cases from a data frame object using the `subset` function from base R, use the `<-` operator to name the filtered data frame that we are about to create. For this example, I name the new joined data frame `filterdf`; you could name it whatever you would like. To the right of the `<-` operator, type the name of `subset` function from base R. As the first argument in the function, enter the name of the data frame we created above (`mergeddf`). As the second argument, type the name of the variable we wish to filter the data frame by, which in this example is `gender` followed by a logical/conditional argument. For this example, we wish to to retain only those cases in which `gender` is equal to "female", and we do so using this logical arguent `gender=="female"`. Because the `gender` variable is of type *character*, we need to put quotation marks (`" "`) around the value of the variable that we wish to filter by. Remember, object names in R are case and space sensitive; for instance, `gender` is different from `Gender`, and "female" is different from "Female".

```{r}
# Filter by gender
filterdf <- subset(mergeddf, gender=="female")

# View filtered data frame
filterdf
```

Note how the data frame above contains only those cases with "female" as their `gender` variable designation. The filter worked as expected.
  
Alternatively, we could filter *out* those cases in which `gender` is equal to "female" using the `!=` (not equal to) logical operator.

```{r}
# Filter by gender
filterdf <- subset(mergeddf, gender!="female")

# View filtered data frame
filterdf
```

Note how cases with `gender` equal to "female" are no longer in the data frame, while every other case is retained.
  
Let's now filter by a variable of type *numeric* (or *integer*). Specifically, let's select those cases in which the `perf_q2` variable is greater than (`>`) 4.0. Because the `perf_q2` variable is of type *numeric*, we don't use quotation marks (`" "`) around the value we wish to filter by, which in this case is 4.0. 

```{r}
# Filter by perf_q2
filterdf <- subset(mergeddf, perf_q2>4.0)

# View filtered data frame
filterdf
```

If we wish to filter by two variables, we can apply the logical "or" (`|`) operator or "and" (`&`) operator. First, let's select those cases in which either `gender` is equal to "female" or `perf_q2` is greater than 4.0 using the "or" (`|`) operator.

```{r}
# Filter by gender or perf_q2
filterdf <- subset(mergeddf, gender=="female" | perf_q2>4.0)

# View filtered data frame
filterdf
```

Watch what happens if we apply the logical "and" (`&`) operator with the same syntax as above.

```{r}
# Filter by gender and perf_q2
filterdf <- subset(mergeddf, gender=="female" & perf_q2>4.0)

# View filtered data frame
filterdf
```

We can also use the logical "or" (`|`) operator to select two values of the same variable.

```{r}
# Filter by two values of firstname
filterdf <- subset(mergeddf, firstname=="John" | firstname=="Jane")

# View filtered data frame
filterdf
```

Or we can select two ranges of values from the same variable using the logical "or" (`|`) operator, assuming the variable is of type numeric, integer, or date.

```{r}
# Filter by two ranges of values of perf_q1
filterdf <- subset(mergeddf, perf_q1<=2.5 | perf_q1>=4.0)

# View filtered data frame
filterdf
```

The `subset` function can also be used to remove multiple specific cases (such as from a unique identifier variable), which might be useful when you've identified outliers that need to be removed. As a first step, identify a vector of values that need to be removed. In this example, let's pretend that cases with `id` variable values of 198 and 201 no longer work for this company, so they should be removed from the sample. To create a vector of these two values, use the `c` function like this: `c(198,201)`. Next, because you are now filtering by a vector, you will need to use the `%in%` operator, which is an operator that instructs R to go through each value of the filter variable (`id`) and identify instances of 198 and 201 (`c(198,201)`); if the values match, then those cases are retained. However, because we entered `!` in front of the filter variable, this actually reverses our logic and instructs R to *remove* those cases in which a value of the filter variable matches a value contained in the vector. 

```{r error=TRUE}
# Filter out id of 198 and 201
filterdf <- subset(mergeddf, !id %in% c(198,201))

# View filtered data frame
filterdf
```

Note that in the output above cases with `id` variable values equal to 198 and 201 are no longer present.
  
If you remove the `!` in front of the filter variable, only cases `198` and `201` are retained.

```{r error=TRUE}
# Filter in id of 198 and 201
filterdf <- subset(mergeddf, id %in% c(198,201))

# View filtered data frame
filterdf
```

You can also drop specific cases one by one using the not equal to operator (`!=`) and the a unique identifier value associated with the case you wish to remove. We accomplish the same result as above but use two steps instead. Also, note that in the second step below, the new data frame object (`filterdf`) is used as the first argument because we want to retain the changes we made in the prior step (i.e., dropping case with `id` equal to 198).

```{r error=TRUE}
# Filter out id of 198
filterdf <- subset(mergeddf, id!=198)

# Filter out id of 201
filterdf <- subset(filterdf, id!=201)

# View filtered data frame
filterdf
```

When working with variables of type *Date*, things can get a bit trickier. When we applied the `str` function from base R (see above), we found that the `startdate` variable was read in and joined as a character variable as opposed to a date variable. As such, we need to convert the `startdate` variable using the `as.Date` function from base R. First, type the name of the data frame object (`mergeddf`), followed by the `$` operator and the name of whatever you want to call the new variable (`startdate2`); remember, the `$` operator tells R that a variable belongs to (or will belong to) a particular data frame. Second, type the `<-` operator. Third, type the name of the `as.Date` function. Fourth, in the function parentheses, as the first argument, enter the `as.character` function with the name of the data frame object (`mergeddf`), followed by the `$` operator and the name the original variable (`startdate`) as the sole argument. Fifth, as the second argument in the `as.Date` function, type `format="%m/%d/%Y"` to indicate the format for the data variable; note that the capital `Y` in `%Y` implies a 4-digit year, whereas a lower case would imply a 2-digit year.

```{r}
# Convert character startdate variable to the Date type startdate2 variable
mergeddf$startdate2 <- as.Date(as.character(mergeddf$startdate), format="%m/%d/%Y")
```

To verify that the new `startdate2` variable is of type *Date*, use the `str` function from base R, and enter the name of the data frame object (`mergeddf`) as the sole argument. As you will see, the new `startdate2` variable is now of type *Date*.

```{r}
# Verify that the startdate2 variable is now a variable of type Date
str(mergeddf)
```

Now we are ready to filter using the new `startdate2` variable. When specify the value of the `startdate2` variable by which you wish to filter by, make sure to use the `as.Date` function once more with the date (formatted as YYYY-MM-DD) in quotation marks (`" "`) as the sole argument. Here, I filter for those cases in which their `startdate2` values are greater than 2016-01-07.

```{r}
# Filter by startdate2
filterdf <- subset(mergeddf, startdate2 > as.Date("2016-01-07"))

# View filtered data frame
print(filterdf)
```

### Select Single Variable from Data Frame

To display a single variable from a data frame in our Console, within the `subset` function, we can enter the data frame object as the first argument (`filterdf`) and `select=` followed by the name of a single variable (`startdate`). Using the `<-` operator, we can create a new data frame object and assign the single variable to that new object. Here, I'm calling this new object `temp`, as that signals to me that the object will be temporary and thus not used for subsequent operations.

```{r}
# Select only one variable from a data frame
temp <- subset(mergeddf, select=startdate)

# Print data frame
print(temp)
```

### Select Multiple Variables from Data Frame

If our goal is to select multiple variables from a data frame (and remove all others), we can use the `subset` function as follows. As we did above, name new data frame object using the `<-` operator, and here we will overwrite the `filterdf` objec we previously created. As the first argument in the `subset` function, type the name of your original data frame object (`mergeddf`). As the second argument, type `select=` followed by a vector of variable name you wish to select/retain. The order in which you enter the variable names will correspond to the order in which they appear in the new data frame object. Use the `c` (combine) function from base R with each variable name you wish to select as arguments separated by commas. 

```{r}
# Select multiple variables
filterdf <- subset(mergeddf, select=c(id, gender, lastname, firstname))

# Print data frame
print(filterdf)
```

### Remove Single Variable from Data Frame

If you need to remove a single variable from a data frame, you can simply type the minus (`-`) operator before the name of the variable you wish to remove. 

```{r}
# Select only one variable from a data frame
filterdf <- subset(mergeddf, select=-startdate)

# Print data frame
print(filterdf)
```

### Remove Multiple Variables from Data Frame

If you wish to remove multiple variables from a data frame, you can apply the same syntax as you did when selecting multiple variables, except insert a minus (`-`) operator in from the of the `c` function. This tells the function to *not* select those variables. Here, we remove the `id` and `gender` variables from the `mergeddf` data frame by overwriting the original `mergeddf` object.

```{r}
# Remove multiple variables
mergeddf <- subset(mergeddf, select= -c(id, gender))

# Print data frame
print(mergeddf)
```